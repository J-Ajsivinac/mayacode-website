---
import { Icon } from "astro-icon/components";
---

<button
    id="scrollTopBtn"
    class="scroll-to-top-btn fixed z-50 bg-white text-black rounded-full shadow-lg hover:bg-gray-100 active:bg-gray-200 transition-all duration-300 opacity-0 pointer-events-none transform translate-y-2 hover:scale-110 active:scale-95"
    aria-label="Volver al inicio de la página"
>
    <Icon name="GravityUiChevronsUp" class="icon-size" />
</button>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("scrollTopBtn");
        let isVisible = false;

        // Función optimizada para mostrar/ocultar el botón
        const toggleButton = () => {
            const shouldShow = window.scrollY > 300;

            if (shouldShow && !isVisible) {
                btn?.classList.remove(
                    "opacity-0",
                    "pointer-events-none",
                    "translate-y-2"
                );
                btn?.classList.add("opacity-100", "translate-y-0");
                isVisible = true;
            } else if (!shouldShow && isVisible) {
                btn?.classList.add(
                    "opacity-0",
                    "pointer-events-none",
                    "translate-y-2"
                );
                btn?.classList.remove("opacity-100", "translate-y-0");
                isVisible = false;
            }
        };

        // Throttle para optimizar el rendimiento
        let ticking = false;
        const handleScroll = () => {
            if (!ticking) {
                requestAnimationFrame(() => {
                    toggleButton();
                    ticking = false;
                });
                ticking = true;
            }
        };

        // Event listeners
        window.addEventListener("scroll", handleScroll, { passive: true });

        // Scroll suave al hacer clic
        btn?.addEventListener("click", () => {
            window.scrollTo({
                top: 0,
                behavior: "smooth",
            });

            // Feedback visual
            btn.classList.add("animate-pulse");
            setTimeout(() => {
                btn?.classList.remove("animate-pulse");
            }, 300);
        });

        // Mejorar accesibilidad con teclado
        btn?.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                btn.click();
            }
        });
    });
</script>

<style>
    .scroll-to-top-btn {
        /* Posicionamiento responsivo */
        bottom: 1rem;
        right: 1rem;

        /* Tamaño base para móviles */
        width: 3rem;
        height: 3rem;
        padding: 0.75rem;

        /* Efectos visuales */
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow:
            0 4px 6px -1px rgba(0, 0, 0, 0.1),
            0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    /* Icono responsive */
    .icon-size {
        width: 1.25rem;
        height: 1.25rem;
        display: block;
        margin: auto;
    }

    /* Ajustes para móviles pequeños */
    @media (max-width: 375px) {
        .scroll-to-top-btn {
            bottom: 0.75rem;
            right: 0.75rem;
            width: 2.75rem;
            height: 2.75rem;
            padding: 0.625rem;
        }

        .icon-size {
            width: 1.125rem;
            height: 1.125rem;
        }
    }

    /* Ajustes para móviles estándar */
    @media (min-width: 376px) and (max-width: 640px) {
        .scroll-to-top-btn {
            bottom: 1rem;
            right: 1rem;
            width: 3rem;
            height: 3rem;
            padding: 0.75rem;
        }
    }

    /* Ajustes para tablets */
    @media (min-width: 641px) and (max-width: 1023px) {
        .scroll-to-top-btn {
            bottom: 1.25rem;
            right: 1.25rem;
            width: 3.25rem;
            height: 3.25rem;
            padding: 0.875rem;
        }

        .icon-size {
            width: 1.375rem;
            height: 1.375rem;
        }
    }

    /* Ajustes para desktop */
    @media (min-width: 1024px) {
        .scroll-to-top-btn {
            bottom: 1.5rem;
            right: 1.5rem;
            width: 3.5rem;
            height: 3.5rem;
            padding: 1rem;
        }

        .icon-size {
            width: 1.5rem;
            height: 1.5rem;
        }
    }

    /* Ajustes para pantallas grandes */
    @media (min-width: 1400px) {
        .scroll-to-top-btn {
            bottom: 2rem;
            right: 2rem;
            width: 4rem;
            height: 4rem;
            padding: 1.125rem;
        }

        .icon-size {
            width: 1.75rem;
            height: 1.75rem;
        }
    }

    /* Estados de hover mejorados para desktop */
    @media (min-width: 1024px) {
        .scroll-to-top-btn:hover {
            box-shadow:
                0 10px 15px -3px rgba(0, 0, 0, 0.1),
                0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
    }

    /* Prevenir interferencia con elementos fixed */
    .scroll-to-top-btn {
        z-index: 9999;
    }

    /* Asegurar que no interfiera con el contenido */
    @media (max-width: 640px) {
        /* Evitar conflictos con FABs o navegación inferior */
        .scroll-to-top-btn {
            bottom: calc(env(safe-area-inset-bottom) + 1rem);
            right: calc(env(safe-area-inset-right) + 1rem);
        }
    }

    /* Modo oscuro support (opcional) */
    @media (prefers-color-scheme: dark) {
        .scroll-to-top-btn {
            background-color: rgba(31, 41, 55, 0.9);
            color: white;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .scroll-to-top-btn:hover {
            background-color: rgba(55, 65, 81, 0.9);
        }

        .scroll-to-top-btn:active {
            background-color: rgba(75, 85, 99, 0.9);
        }
    }

    /* Respeto por preferencias de animación */
    @media (prefers-reduced-motion: reduce) {
        .scroll-to-top-btn {
            transition: opacity 0.2s ease !important;
            transform: none !important;
        }

        .scroll-to-top-btn:hover {
            transform: none !important;
        }

        .animate-pulse {
            animation: none !important;
        }
    }

    /* Mejorar el tap target en móviles */
    @media (pointer: coarse) {
        .scroll-to-top-btn {
            min-width: 44px;
            min-height: 44px;
        }
    }
</style>
